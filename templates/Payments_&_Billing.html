<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Payments & Billing</title>
    <link rel="stylesheet" href="../static/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

<div class="sidebar">
    <h2>Quetta Hotel</h2>
    <a href="{{ url_for('index') }}" class="menu-item"><i class="fas fa-home"></i> Dashboard</a>
    <a href="{{ url_for('room_management') }}" class="menu-item"><i class="fas fa-bed"></i> Room Management</a>
    <a href="{{ url_for('booking_management') }}" class="menu-item"><i class="fas fa-calendar-check"></i> Bookings</a>
    <a href="{{ url_for('kitchen_menu') }}" class="menu-item"><i class="fas fa-utensils"></i> Kitchen / Menu</a>
    <a href="{{ url_for('payments') }}" class="menu-item active"><i class="fas fa-file-invoice-dollar"></i> Payments</a>
</div>

<div class="main-content">
    <div class="header">
        <h1>Payments & Billing</h1>
        <div>
            <span>{{ admin_name }}</span>
            <i class="fas fa-user-circle fa-lg"></i>
        </div>
    </div>

    <!-- ================= RECORD PAYMENT (No auto selection) ================= -->
    <div class="form-container">
        <h3><i class="fas fa-cash-register"></i> Record New Transaction</h3>
        <form method="POST" action="{{ url_for('record_payment') }}">
            <div class="payment-form-grid">
                <div class="form-group">
                    <label>Booking ID</label>
                    <select name="booking_id" required>
                        <option value="">-- Select Booking --</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Payment Method</label>
                    <select name="payment_method">
                        <option value="Cash">Cash</option>
                        <option value="Card">Card</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Amount Received</label>
                    <input type="number" name="amount_paid" required>
                </div>

                <div class="full-width" style="text-align:right">
                    <button class="btn-add">
                        <i class="fas fa-check-circle"></i> Confirm Payment
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- ================= TODAY'S CHECKOUT PAYMENTS ================= -->
    <div class="table-container">
        <h3>Today's Due Payments</h3>
        <table>
            <thead>
                <tr>
                    <th>Booking ID</th>
                    <th>Customer</th>
                    <th>Phone</th>
                    <th>Total Amount</th>
                    <th>Checkout Date</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for p in today_due %}
                <tr>
                    <td>#{{ p.booking_id }}</td>
                    <td>{{ p.name }}</td>
                    <td>{{ p.phone }}</td>
                    <td>Rs {{ p.total_amount }}</td>
                    <td>{{ p.check_out_date }}</td>
                    <!-- Example inside your table for Pending Payments -->
                    <td>
                        <a href="{{ url_for('generate_invoice', booking_id=p.booking_id) }}" class="btn-print">
                            <i class="fas fa-print"></i> Generate Invoice
                        </a>
                    </td>

                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- ================= TRANSACTION HISTORY ================= -->
    <div class="table-container">
        <h3>Transaction History</h3>
        <table>
            <thead>
                <tr>
                    <th>Payment ID</th>
                    <th>Customer</th>
                    <th>Email</th>
                    <th>Date</th>
                    <th>Method</th>
                    <th>Amount</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for t in transactions %}
                <tr>
                    <td>#{{ t.payment_id }}</td>
                    <td>{{ t.customer_name }}</td>
                    <td>{{ t.email }}</td>
                    <td>{{ t.payment_date }}</td>
                    <td>{{ t.payment_method }}</td>
                    <td>Rs {{ t.amount_paid }}</td>
                    <td><span class="status-badge badge-green">{{ t.payment_status }}</span></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- ================= RECENT COMPLAINTS ================= -->
    <div class="table-container">
        <h3>Recent Complaints</h3>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Guest Name</th>
                    <th>Email</th>
                    <th>Message</th>
                    <th>Submitted At</th>
                </tr>
            </thead>
<tbody>
    {% if recent_complaints %}
        {% for c in recent_complaints %}
        <tr>
            <td>#{{ c.complaint_id }}</td>
            <td>{{ c.guest_name }}</td>
            <td>{{ c.guest_email }}</td>
            <td>{{ c.message }}</td>
            <td>{{ c.submitted_at }}</td>
            <td>
                <form method="POST"
                      action="{{ url_for('resolve_complaint', complaint_id=c.complaint_id) }}">
                    <button class="btn-add" style="padding:6px 10px;">
                        <i class="fas fa-check"></i> Mark Resolved
                    </button>
                </form>
            </td>
        </tr>
        {% endfor %}
    {% else %}
        <tr>
            <td colspan="6" style="text-align:center;">
                No complaints found
            </td>
        </tr>
    {% endif %}
</tbody>

        </table>
    </div>

</div>
</body>
</html>
